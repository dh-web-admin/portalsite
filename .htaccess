# Apache Configuration for PortalSite

# Enable Rewrite Engine
RewriteEngine On

# Redirect to HTTPS behind proxy (Railway)
# Only redirect when the original request was HTTP per proxy header
# This avoids loops when HTTPS termination happens at the proxy
RewriteCond %{HTTP:X-Forwarded-Proto} =http
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Don't rewrite files or directories
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# Security: Block access to sensitive files
<FilesMatch "^(config\.php|\.git|\.env)">
    Order allow,deny
    Deny from all
</FilesMatch>

# PHP settings
php_value upload_max_filesize 10M
php_value post_max_size 10M
php_value max_execution_time 300
php_value max_input_time 300

# Error pages
ErrorDocument 404 /index.php
ErrorDocument 500 /index.php

# Disable directory browsing
Options -Indexes

# Enable compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript
</IfModule>
